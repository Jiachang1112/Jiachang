<!DOCTYPE html>
<html lang="zh-TW" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ•™å­¸è³‡æºåº«</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* --- ğŸ¨ CSS è®Šæ•¸ç³»çµ± --- */
        :root { --bg-color: #f0f2f5; --card-bg: #ffffff; --text-main: #2c3e50; --text-sub: #666666; --border: #eeeeee; --accent: #3498db; --accent-hover: #2980b9; --shadow: 0 4px 20px rgba(0,0,0,0.05); --folder-bg: #f8f9fa; --announce-bg: #fff3cd; --announce-text: #856404; }
        [data-theme="dark"] { --bg-color: #121212; --card-bg: #1e1e1e; --text-main: #e0e0e0; --text-sub: #a0a0a0; --border: #333333; --accent: #4fa3e0; --accent-hover: #6ab0e6; --shadow: 0 4px 20px rgba(0,0,0,0.3); --folder-bg: #2d2d2d; --announce-bg: #3e3825; --announce-text: #ffca2c; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg-color); margin: 0; padding: 0; color: var(--text-main); height: 100vh; transition: background 0.3s, color 0.3s; }
        .hidden { display: none !important; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        #loading-mask { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-color); z-index: 10000; display: flex; justify-content: center; align-items: center; flex-direction: column; color: var(--accent); font-weight: bold; font-size: 18px; transition: 0.3s; }
        .spinner { border: 4px solid var(--border); border-top: 4px solid var(--accent); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #auth-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-color); z-index: 9999; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .auth-box { background: var(--card-bg); padding: 40px; border-radius: 20px; box-shadow: var(--shadow); width: 100%; max-width: 380px; transition: 0.3s; }
        .auth-tabs { display: flex; border-bottom: 2px solid var(--border); margin-bottom: 25px; }
        .auth-tab { flex: 1; text-align: center; padding: 12px; cursor: pointer; color: var(--text-sub); font-weight: bold; transition: 0.3s; }
        .auth-tab.active { color: var(--accent); border-bottom: 2px solid var(--accent); margin-bottom: -2px; }
        .form-title { text-align: center; margin-bottom: 20px; color: var(--text-main); font-size: 22px; font-weight: 700; }
        .input-group { margin-bottom: 15px; }
        input { width: 100%; padding: 14px; border: 2px solid var(--border); border-radius: 10px; background: var(--bg-color); color: var(--text-main); font-size: 16px; transition: 0.3s; }
        input:focus { border-color: var(--accent); outline: none; }
        button.action-btn { width: 100%; padding: 14px; background-color: var(--accent); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; box-shadow: 0 4px 10px rgba(52, 152, 219, 0.2); }
        button.action-btn:hover { background-color: var(--accent-hover); transform: translateY(-1px); }
        button:disabled { background-color: #bdc3c7; cursor: not-allowed; transform: none; box-shadow: none; }
        .msg { font-size: 14px; text-align: center; margin-top: 20px; min-height: 20px; }
        .msg.error { color: #e74c3c; }
        .msg.success { color: #27ae60; }
        .container { max-width: 900px; margin: 20px auto; background: var(--card-bg); border-radius: 20px; box-shadow: var(--shadow); overflow: hidden; min-height: 80vh; display: flex; flex-direction: column; transition: 0.3s; }
        .header-bar { padding: 20px 30px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 15px; }
        .brand { font-size: 22px; font-weight: 700; color: var(--text-main); display: flex; align-items: center; }
        .brand span { margin-right: 8px; }
        .header-tools { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
        .search-box { position: relative; width: 200px; }
        .search-box input { width: 100%; padding: 8px 12px 8px 35px; border-radius: 20px; border: 1px solid var(--border); font-size: 14px; height: 38px; background: var(--bg-color); }
        .search-box svg { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); width: 16px; height: 16px; fill: var(--text-sub); pointer-events: none; }
        .theme-toggle { cursor: pointer; padding: 8px; border-radius: 50%; background: var(--bg-color); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; width: 38px; height: 38px; color: var(--text-main); transition: 0.2s; }
        .theme-toggle:hover { background: var(--border); }
        .user-profile { display: flex; align-items: center; gap: 10px; background: var(--bg-color); padding: 5px 15px; border-radius: 20px; border: 1px solid var(--border); }
        .user-name { font-size: 14px; color: var(--text-main); font-weight: bold; }
        .logout-btn { font-size: 12px; color: #e74c3c; cursor: pointer; font-weight: bold; }
        #announcement-bar { background: var(--announce-bg); color: var(--announce-text); padding: 12px 30px; font-size: 14px; border-bottom: 1px solid rgba(0,0,0,0.05); display: flex; align-items: center; transition: 0.3s; }
        #announcement-bar svg { width: 18px; height: 18px; margin-right: 8px; fill: currentColor; }
        .nav-bar { background: var(--folder-bg); padding: 12px 30px; border-bottom: 1px solid var(--border); display: flex; align-items: center; font-size: 14px; color: var(--text-sub); }
        .breadcrumb { display: flex; align-items: center; flex-grow: 1; overflow-x: auto; white-space: nowrap; scrollbar-width: none; }
        .breadcrumb::-webkit-scrollbar { display: none; }
        .breadcrumb-item { cursor: pointer; color: var(--accent); font-weight: 500; }
        .breadcrumb-item:hover { text-decoration: underline; }
        .breadcrumb-separator { margin: 0 8px; color: var(--text-sub); opacity: 0.5; }
        .breadcrumb-current { color: var(--text-main); font-weight: bold; cursor: default; }
        .back-btn { background: var(--card-bg); border: 1px solid var(--border); padding: 6px 12px; border-radius: 8px; cursor: pointer; font-size: 13px; margin-right: 15px; display: flex; align-items: center; color: var(--text-main); transition: 0.2s; }
        .back-btn:hover { background: var(--border); }
        #list-root { padding: 10px 0; flex-grow: 1; overflow-y: auto; }
        .list-item { display: flex; align-items: center; padding: 18px 30px; border-bottom: 1px solid var(--border); cursor: pointer; transition: all 0.2s; position: relative; }
        .list-item:hover { background-color: var(--folder-bg); transform: translateX(5px); }
        .list-item:last-child { border-bottom: none; }
        .item-icon { font-size: 28px; margin-right: 20px; min-width: 40px; text-align: center; transition: 0.2s; }
        .folder-item .item-icon { color: #f39c12; }
        .file-item .item-icon[data-type="pdf"] { color: #e74c3c; } 
        .file-item .item-icon[data-type="doc"] { color: #3498db; }
        .file-item .item-icon[data-type="img"] { color: #9b59b6; }
        .file-item .item-icon[data-type="ppt"] { color: #e67e22; }
        .file-item .item-icon[data-type="video"] { color: #e056fd; }
        .item-info { flex-grow: 1; }
        .item-name { font-size: 16px; font-weight: 600; color: var(--text-main); margin-bottom: 4px; display: flex; align-items: center; }
        .item-name .highlight { background: #ffeaa7; color: #d35400; padding: 0 2px; border-radius: 2px; }
        .item-note { font-size: 13px; color: var(--text-sub); }
        .item-arrow { color: var(--border); font-size: 14px; opacity: 0.5; }
        .folder-item:hover .item-arrow { opacity: 1; color: var(--accent); transform: translateX(3px); transition: 0.2s; }
        @media (max-width: 600px) {
            .container { margin: 0; border-radius: 0; min-height: 100vh; }
            .header-bar { padding: 15px 20px; }
            .header-tools { width: 100%; justify-content: space-between; margin-top: 10px; }
            .search-box { width: 100%; flex-grow: 1; margin-right: 10px; }
            .list-item { padding: 15px 20px; }
        }
        @keyframes slideDown { from { transform: translateY(-10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>

    <div id="loading-mask"><div class="spinner"></div><div>è³‡æ–™è®€å–ä¸­...</div></div>

    <div id="auth-container">
        <div class="auth-box">
            <div class="auth-tabs"><div class="auth-tab active" onclick="switchMode('login')">æœƒå“¡ç™»å…¥</div><div class="auth-tab" onclick="switchMode('register')">è¨»å†Šå¸³è™Ÿ</div></div>
            <div id="login-form">
                <div class="form-title">ğŸ‘‹ æ­¡è¿å›ä¾†</div>
                <div class="input-group"><input type="email" id="loginEmail" placeholder="é›»å­ä¿¡ç®±"></div>
                <div class="input-group"><input type="password" id="loginPass" placeholder="å¯†ç¢¼"></div>
                <button class="action-btn" onclick="handleLogin()" id="loginBtn">ç™»å…¥ç³»çµ±</button>
            </div>
            <div id="register-form" class="hidden">
                <div class="form-title">ğŸ“ å»ºç«‹æ–°å¸³è™Ÿ</div>
                <div class="input-group"><input type="text" id="regName" placeholder="æ‚¨çš„å§“å"></div>
                <div class="input-group"><input type="email" id="regEmail" placeholder="é›»å­ä¿¡ç®±"></div>
                <div class="input-group"><input type="password" id="regPass" placeholder="è¨­å®šå¯†ç¢¼ (è‡³å°‘6ä½)"></div>
                <button class="action-btn" onclick="handleRegister()" id="regBtn" style="background-color:#27ae60;">æäº¤è¨»å†Šç”³è«‹</button>
            </div>
            <div id="msg-box" class="msg"></div>
        </div>
    </div>

    <div id="content" class="hidden">
        <div class="container">
            <div class="header-bar">
                <div class="brand"><span>ğŸ“š</span> <div id="page-title">æ•™å­¸è³‡æºåº«</div></div>
                <div class="header-tools">
                    <div class="search-box">
                        <svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                        <input type="text" id="searchInput" placeholder="æœå°‹é—œéµå­—..." onkeyup="handleSearch()">
                    </div>
                    <div class="theme-toggle" onclick="toggleTheme()"><span id="theme-icon">ğŸŒ™</span></div>
                    <div class="user-profile"><span class="user-name" id="user-display">User</span><div class="logout-btn" onclick="logout()">ç™»å‡º</div></div>
                </div>
            </div>

            <div id="announcement-bar" class="hidden">
                <svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/></svg>
                <span id="announcement-text"></span>
            </div>

            <div class="nav-bar">
                <button id="backBtn" class="back-btn hidden" onclick="goUp()">
                    <span style="margin-right:5px;">â¬…</span> è¿”å›
                </button>
                <div class="breadcrumb" id="breadcrumb-container"></div>
            </div>
            <div id="list-root"></div>
        </div>
    </div>

    <script src="config.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // ğŸŸ¢ Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyBZe0HHikgGG9hS3g32jWJ-fzESOTB3Zdw",
            authDomain: "jiachang-2cda4.firebaseapp.com",
            projectId: "jiachang-2cda4",
            storageBucket: "jiachang-2cda4.firebasestorage.app",
            messagingSenderId: "752423213714",
            appId: "1:752423213714:web:e03fc6967d355e9bbc644b",
            measurementId: "G-8GETJKDCEW"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // ğŸŸ¢ 2. æ™ºæ…§å•å€™
        function getGreeting() {
            const hour = new Date().getHours();
            if (hour < 12) return "æ—©å®‰";
            if (hour < 18) return "åˆå®‰";
            return "æ™šå®‰";
        }

        // ğŸŸ¢ 3. æ·±è‰²æ¨¡å¼
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
        }
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }
        function updateThemeIcon(theme) {
            document.getElementById('theme-icon').innerText = theme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
        }

        // ğŸŸ¢ 4. ç›£è½å…¬å‘Š
        function listenForAnnouncements() {
            db.collection("system").doc("announcement").onSnapshot((doc) => {
                const bar = document.getElementById('announcement-bar');
                if (doc.exists && doc.data().active && doc.data().text) {
                    bar.classList.remove('hidden');
                    document.getElementById('announcement-text').innerText = doc.data().text;
                } else {
                    bar.classList.add('hidden');
                }
            });
        }

        initTheme();

        // Auth ç›£è½
        auth.onAuthStateChanged((user) => {
            if (user) {
                checkUserStatus(user);
            } else {
                document.getElementById('loading-mask').style.display = 'none';
            }
        });

        // ä»‹é¢åˆ‡æ›
        function switchMode(mode) {
            document.querySelectorAll('.auth-tab').forEach(el => el.classList.remove('active'));
            document.getElementById('msg-box').innerText = '';
            if (mode === 'login') {
                document.querySelectorAll('.auth-tab')[0].classList.add('active');
                document.getElementById('login-form').classList.remove('hidden');
                document.getElementById('register-form').classList.add('hidden');
            } else {
                document.querySelectorAll('.auth-tab')[1].classList.add('active');
                document.getElementById('login-form').classList.add('hidden');
                document.getElementById('register-form').classList.remove('hidden');
            }
        }
        function showMsg(text, type) {
            const el = document.getElementById('msg-box');
            el.innerText = text;
            el.className = 'msg ' + type;
        }

        // è¨»å†Šèˆ‡ç™»å…¥
        function handleRegister() {
            const name = document.getElementById('regName').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const pass = document.getElementById('regPass').value.trim();
            if(!name || !email || !pass) return showMsg("æ‰€æœ‰æ¬„ä½éƒ½è¦å¡«å¯«å–”", "error");
            if(pass.length < 6) return showMsg("å¯†ç¢¼è‡³å°‘è¦ 6 å€‹å­—", "error");
            const btn = document.getElementById('regBtn');
            btn.disabled = true; btn.innerText = "è¨»å†Šä¸­...";
            auth.createUserWithEmailAndPassword(email, pass).then((userCredential) => {
                return db.collection("users").doc(userCredential.user.uid).set({
                    name: name, email: email, status: "pending", createdAt: new Date()
                });
            }).then(() => {
                showMsg("è¨»å†ŠæˆåŠŸï¼è«‹ç­‰å¾…æ ¸å‡†ã€‚", "success");
                btn.disabled = false; btn.innerText = "æäº¤è¨»å†Šç”³è«‹";
                auth.signOut(); setTimeout(() => switchMode('login'), 3000);
            }).catch((error) => {
                btn.disabled = false; btn.innerText = "æäº¤è¨»å†Šç”³è«‹";
                showMsg("è¨»å†Šå¤±æ•—: " + error.message, "error");
            });
        }
        function handleLogin() {
            const email = document.getElementById('loginEmail').value.trim();
            const pass = document.getElementById('loginPass').value.trim();
            if(!email || !pass) return showMsg("è«‹è¼¸å…¥å¸³è™Ÿå¯†ç¢¼", "error");
            const btn = document.getElementById('loginBtn');
            btn.disabled = true; btn.innerText = "é©—è­‰ä¸­...";
            auth.signInWithEmailAndPassword(email, pass).catch((error) => {
                btn.disabled = false; btn.innerText = "ç™»å…¥ç³»çµ±";
                showMsg("å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤", "error");
            });
        }
        function checkUserStatus(user) {
            db.collection("users").doc(user.uid).get().then((doc) => {
                document.getElementById('loading-mask').style.display = 'none';
                if (doc.exists) {
                    const userData = doc.data();
                    if (userData.status === 'approved') {
                        enterSite(userData.name);
                    } else {
                        auth.signOut();
                        document.getElementById('loginBtn').disabled = false;
                        document.getElementById('loginBtn').innerText = "ç™»å…¥ç³»çµ±";
                        showMsg("æ‚¨çš„å¸³è™Ÿå°šåœ¨å¯©æ ¸ä¸­ã€‚", "error");
                    }
                } else { showMsg("æ‰¾ä¸åˆ°ä½¿ç”¨è€…è³‡æ–™", "error"); }
            }).catch((error) => { document.getElementById('loading-mask').style.display = 'none'; showMsg("è®€å–è³‡æ–™å¤±æ•—", "error"); });
        }
        function enterSite(userName) {
            document.getElementById('auth-container').classList.add('hidden');
            document.getElementById('content').classList.remove('hidden');
            document.getElementById('user-display').innerText = `${getGreeting()}ï¼Œ${userName}`;
            initSite(); 
            listenForAnnouncements(); 
        }
        function logout() {
            if(confirm("ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ")) {
                auth.signOut().then(() => location.reload());
            }
        }

        // --- ğŸŸ¢ æ ¸å¿ƒï¼šå¾é›²ç«¯è®€å–æª”æ¡ˆçµæ§‹ (é—œéµä¿®æ”¹) ---
        let pathStack = [];
        let allFilesFlat = [];
        let cloudItems = []; // å„²å­˜å¾é›²ç«¯æŠ“ä¸‹ä¾†çš„è³‡æ–™

        function initSite() {
            document.title = CONFIG.pageTitle;
            document.getElementById("page-title").innerText = CONFIG.pageTitle;
            
            // ğŸŸ¢ æ”¹æˆç›£è½é›²ç«¯æª”æ¡ˆè®Šæ›´
            db.collection('system').doc('files').onSnapshot(doc => {
                if (doc.exists && doc.data().items) {
                    cloudItems = doc.data().items;
                    allFilesFlat = flattenItems(cloudItems);
                    // å¦‚æœç›®å‰åœ¨æœå°‹æ¨¡å¼ï¼Œé‡æ–°æœå°‹ï¼›å¦å‰‡é‡æ–°æ¸²æŸ“ç•¶å‰è³‡æ–™å¤¾
                    if(document.querySelector('.nav-bar').classList.contains('hidden')) {
                        handleSearch();
                    } else {
                        // é‡æ–°æ•´ç†ç›®å‰ç•«é¢ (ä¿æŒåœ¨åŒä¸€å€‹è³‡æ–™å¤¾)
                        refreshCurrentView();
                    }
                } else {
                    // å¦‚æœé›²ç«¯æ²’è³‡æ–™ï¼Œæš«æ™‚é¡¯ç¤ºç©ºçš„ (ç­‰å¾…ç®¡ç†å“¡åŒ¯å…¥)
                    cloudItems = [];
                    renderList([]);
                }
            });
        }

        function refreshCurrentView() {
            // æ ¹æ“š pathStack é‡æ–°å®šä½åˆ°ç•¶å‰è³‡æ–™å¤¾
            // é€™è£¡ç°¡åŒ–è™•ç†ï¼šå¦‚æœçµæ§‹è®Šäº†ï¼Œç›´æ¥å›åˆ°é¦–é æ¯”è¼ƒå®‰å…¨
            if (pathStack.length === 0) {
                renderList(cloudItems);
            } else {
                pathStack = []; // é‡ç½®è·¯å¾‘ï¼Œå›åˆ°é¦–é 
                renderList(cloudItems);
            }
            updateBreadcrumb();
        }

        function flattenItems(items) {
            let result = [];
            items.forEach(item => {
                if(item.type === 'file') { result.push(item); } 
                else if(item.type === 'folder' && item.children) { result = result.concat(flattenItems(item.children)); }
            });
            return result;
        }

        function handleSearch() {
            const query = document.getElementById('searchInput').value.toLowerCase().trim();
            const navBar = document.querySelector('.nav-bar');
            if (query.length > 0) {
                navBar.classList.add('hidden');
                const matchedFiles = allFilesFlat.filter(item => 
                    item.name.toLowerCase().includes(query) || (item.note && item.note.toLowerCase().includes(query))
                );
                renderSearchList(matchedFiles, query);
            } else {
                navBar.classList.remove('hidden');
                if(pathStack.length === 0) renderList(cloudItems);
                else renderList(pathStack[pathStack.length - 1].children);
            }
        }

        function renderSearchList(items, query) {
            const container = document.getElementById("list-root");
            container.innerHTML = "";
            if (items.length === 0) {
                container.innerHTML = '<div style="text-align:center; padding:40px; color:var(--text-sub);">æ²’æœ‰æ‰¾åˆ°ç¬¦åˆçš„æª”æ¡ˆ</div>';
                return;
            }
            items.forEach(item => {
                const highlightedName = item.name.replace(new RegExp(query, "gi"), (match) => `<span class="highlight">${match}</span>`);
                renderFileItem(container, item, highlightedName);
            });
        }

        function renderList(items) {
            const container = document.getElementById("list-root");
            container.innerHTML = ""; 
            if (!items || items.length === 0) {
                container.innerHTML = '<div style="text-align:center; padding:40px; color:var(--text-sub);">(æ­¤è³‡æ–™å¤¾æ˜¯ç©ºçš„)</div>';
                return;
            }
            items.forEach(item => {
                if (item.type === 'folder') {
                    const div = document.createElement("div");
                    div.className = "list-item folder-item";
                    div.innerHTML = `<div class="item-icon">ğŸ“</div><div class="item-info"><div class="item-name">${item.name}</div><div class="item-note">${item.children ? item.children.length + ' å€‹é …ç›®' : 'ç©ºè³‡æ–™å¤¾'}</div></div><div class="item-arrow">â¤</div>`;
                    div.onclick = () => enterFolder(item);
                    container.appendChild(div);
                } else {
                    renderFileItem(container, item, item.name);
                }
            });
        }

        function renderFileItem(container, item, displayName) {
            const div = document.createElement("div");
            let icon = item.icon || 'ğŸ“„';
            let fileType = 'doc';
            if (icon === 'ğŸ¥' || item.path.includes('youtu')) fileType = 'video';
            else if (icon === 'ğŸ–¼ï¸' || item.path.match(/\.(jpg|png|jpeg)$/i)) fileType = 'img';
            else if (item.path.match(/\.pdf$/i)) fileType = 'pdf';
            else if (item.path.match(/\.ppt(x)?$/i)) fileType = 'ppt';
            div.className = "list-item file-item";
            div.innerHTML = `<div class="item-icon" data-type="${fileType}">${icon}</div><div class="item-info"><div class="item-name">${displayName}</div><div class="item-note">${item.note || ''}</div></div>`;
            div.onclick = () => window.open(item.path, '_blank');
            container.appendChild(div);
        }

        function enterFolder(folderItem) { pathStack.push(folderItem); renderList(folderItem.children); updateBreadcrumb(); }
        function goUp() { if (pathStack.length > 0) { pathStack.pop(); if (pathStack.length === 0) renderList(cloudItems); else renderList(pathStack[pathStack.length - 1].children); updateBreadcrumb(); } }
        function jumpTo(index) { if (index === -1) { pathStack = []; renderList(cloudItems); } else { pathStack = pathStack.slice(0, index + 1); renderList(pathStack[pathStack.length - 1].children); } updateBreadcrumb(); }
        function updateBreadcrumb() {
            const backBtn = document.getElementById("backBtn");
            if (pathStack.length > 0) backBtn.classList.remove("hidden"); else backBtn.classList.add("hidden");
            // ğŸŸ¢ ä¿®æ”¹éºµåŒ…å±‘ç‚ºå®Œæ•´è·¯å¾‘
            let html = `<span class="breadcrumb-item" onclick="jumpTo(-1)">é¦–é </span>`;
            pathStack.forEach((folder, index) => {
                html += `<span class="breadcrumb-separator">/</span>`;
                if (index === pathStack.length - 1) {
                    html += `<span class="breadcrumb-current">${folder.name}</span>`;
                } else {
                    html += `<span class="breadcrumb-item" onclick="jumpTo(${index})">${folder.name}</span>`;
                }
            });
            document.getElementById("breadcrumb-container").innerHTML = html;
        }
    </script>
</body>
</html>
